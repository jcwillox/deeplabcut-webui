var le=Object.defineProperty,se=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var G=(l,t,o)=>t in l?le(l,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[t]=o,N=(l,t)=>{for(var o in t||(t={}))ne.call(t,o)&&G(l,o,t[o]);if(H)for(var o of H(t))ue.call(t,o)&&G(l,o,t[o]);return l},J=(l,t)=>se(l,re(t));import{d as ie,a as S,c as x,b as de,o as f,e as g,w as u,f as r,V as Z,g as z,h as U,i as I,j as $,k as ee,l as ce,u as c,m as C,n as E,p as K,q as pe,r as b,s as me,t as T,v as te,F as D,x as fe,y as ve,z as _e,A as P,B as ye,C as F,D as Ve,E as he,G as ge,H as R,I as oe,J as Q,K as be,L as ke,M as xe,N as w,O as we,P as Se,Q as je,R as M,S as $e,T as Ce,U as Te,W as Le,X as Fe,Y as Ue,Z as Pe,_ as Be,$ as Ee,a0 as Re,a1 as Ie,a2 as Ae,a3 as Ne,a4 as Oe,a5 as De,a6 as ze,a7 as O,a8 as Ke,a9 as Me,aa as qe,ab as We,ac as He,ad as Ge}from"./vendor.215b8c30.js";const Je=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function o(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerpolicy&&(s.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?s.credentials="include":e.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(e){if(e.ep)return;e.ep=!0;const s=o(e);fetch(e.href,s)}};Je();const j=ie({id:"global",state:()=>({project:"",video:"",backend:"http://127.0.0.1:8000"}),actions:{resetProject(){this.project="",this.video=""}}}),Qe=b("Settings"),Xe=b("mdi-close"),Ye=S({props:{modelValue:{type:Boolean},theme:null},emits:["update:modelValue","update:theme"],setup(l,{emit:t}){const o=l,a=j(),e=x({get:()=>o.modelValue,set:n=>t("update:modelValue",n)}),s=x({get:()=>de(o.theme),set:n=>{t("update:theme",n.toLowerCase())}});return(n,i)=>(f(),g(pe,{modelValue:c(e),"onUpdate:modelValue":i[3]||(i[3]=m=>C(e)?e.value=m:null),temporary:"",position:"right",width:300},{default:u(()=>[r(ee,null,{default:u(()=>[r(Z,null,{default:u(()=>[Qe]),_:1}),r(z),r(U,{icon:"",onClick:i[0]||(i[0]=I(m=>e.value=!1,["stop"]))},{default:u(()=>[r($,null,{default:u(()=>[Xe]),_:1})]),_:1})]),_:1}),r(K,null,{default:u(()=>[r(ce,{items:["Auto","Light","Dark"],class:"pb-3",modelValue:c(s),"onUpdate:modelValue":i[1]||(i[1]=m=>C(s)?s.value=m:null),label:"Theme","hide-details":""},null,8,["modelValue"]),r(E,{label:"Backend",modelValue:c(a).backend,"onUpdate:modelValue":i[2]||(i[2]=m=>c(a).backend=m),"hide-details":""},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]))}}),q=me({options:{async beforeFetch({url:l,options:t}){const o=j(),a=new URL(l,o.backend);return o.project!=""&&a.searchParams.append("project",o.project),l=a.toString(),{url:l,options:t}}},fetchOptions:{mode:"cors"}});function B(l){const t=String(~~(l/3600)).padStart(2,"0"),o=String(~~(l%3600/60)).padStart(2,"0"),a=String(~~l%60).padStart(2,"0"),e=String(~~((l-~~l)*1e3)).padStart(3,"0");return`${t}:${o}:${a}.${e}`}const Ze=S({props:{items:null},emits:["selected"],setup(l,{emit:t}){const o=e=>e.name.toLowerCase().endsWith(".mp4")?"mdi-movie":e.folder?"mdi-folder":"mdi-file-outline",a=e=>{e&&e.length>0&&t("selected",e[0])};return(e,s)=>(f(),g(ge,{"onUpdate:selected":a},{default:u(()=>[(f(!0),T(D,null,te(l.items,(n,i)=>(f(),T(D,{key:i},[r(Ve,{value:n.name,"two-line":""},{default:u(()=>[r(fe,{class:"v-list-item-avatar--start",start:""},{default:u(()=>[r($,{icon:o(n)},null,8,["icon"])]),_:2},1024),r(ve,null,{default:u(()=>[r(_e,{textContent:P(n.name)},null,8,["textContent"]),n.size?(f(),g(ye,{key:0},{default:u(()=>[b(P((n.size/1073741824).toFixed(2))+" GiB",1)]),_:2},1024)):F("",!0)]),_:2},1024)]),_:2},1032,["value"]),i<l.items.length-1?(f(),g(he,{key:i})):F("",!0)],64))),128))]),_:1}))}}),et=b("Select Video"),tt=b("mdi-close"),ae=S({props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(l,{emit:t}){const o=l,a=j(),e=x({get:()=>o.modelValue,set:y=>{t("update:modelValue",y)}}),{execute:s,data:n,isFetching:i}=q("videos",{immediate:!1}).get().json();R(e,()=>e.value&&s());const m=y=>{a.video=y,e.value=!1};return(y,k)=>(f(),g(xe,{modelValue:c(e),"onUpdate:modelValue":k[1]||(k[1]=p=>C(e)?e.value=p:null),scrollable:"",fullscreen:""},{default:u(()=>[oe(y.$slots,"default"),r(ke,{class:"d-flex flex-column"},{default:u(()=>[r(ee,{color:"primary",fixed:""},{default:u(()=>[r(Z,null,{default:u(()=>[et]),_:1}),r(z),r(U,{icon:"",dark:"",onClick:k[0]||(k[0]=p=>e.value=!1)},{default:u(()=>[r($,null,{default:u(()=>[tt]),_:1})]),_:1})]),_:1}),c(i)?(f(),g(Q,{key:0,class:"d-flex flex-column pb-4 align-center justify-center flex-grow-1"},{default:u(()=>[r(be,{indeterminate:"",color:"primary"})]),_:1})):(f(),g(Q,{key:1,class:"pt-0",style:{"overflow-y":"scroll",height:"calc(100vh - 56px)"}},{default:u(()=>[r(Ze,{style:{margin:"auto","max-width":"680px"},items:c(n),onSelected:m},null,8,["items"])]),_:1}))]),_:1})]),_:3},8,["modelValue"]))}});var ot=(l,t)=>{const o=l.__vccOpts||l;for(const[a,e]of t)o[a]=e;return o};const at=l=>(Se("data-v-6ca55cf9"),l=l(),je(),l),lt=b("mdi-folder"),st={key:1},rt=at(()=>M("span",{class:"pr-1"},"/",-1)),nt=b("mdi-movie"),ut=b("mdi-close"),it=S({setup(l){const t=j(),o=w(!1);return(a,e)=>c(t).project?(f(),g(we,{key:0,app:"",color:"primary-darken-1",class:"flex-grow-0 pl-0"},{default:u(()=>[c(t).project?(f(),g(U,{key:0,variant:"text",size:"small",ripple:!1},{default:u(()=>[r($,{left:""},{default:u(()=>[lt]),_:1}),b(" "+P(c(t).project),1)]),_:1})):F("",!0),c(t).video?(f(),T("span",st,[rt,r(U,{variant:"text",size:"small",onClick:e[0]||(e[0]=I(s=>o.value=!0,["stop"]))},{default:u(()=>[r($,{left:""},{default:u(()=>[nt]),_:1}),b(" "+P(c(t).video),1)]),_:1})])):F("",!0),r(z),r($,{onClick:c(t).resetProject},{default:u(()=>[ut]),_:1},8,["onClick"]),r(ae,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value=s)},null,8,["modelValue"])]),_:1})):F("",!0)}});var dt=ot(it,[["__scopeId","data-v-6ca55cf9"]]);const ct=S({setup(l){const t=j(),o=x(()=>!t.project||!t.video),a=w(!1),e=$e("theme","auto"),s=Ce(),n=x(()=>e.value=="auto"?s.value:e.value),i=Te(),m=Le(),y=w(""),k=x(()=>o.value?["project"]:["extract","label","analyse"]);return R([()=>t.project,()=>t.video],([p,d])=>{!p||!d?m.push({name:"project"}):p&&d&&i.name=="project"&&m.push({name:"extract"})},{immediate:!0}),R(i,()=>{i.name&&(y.value=i.name.toString())},{immediate:!0}),(p,d)=>{const V=Ae("router-view");return f(),g(Ie,{theme:c(n)},{default:u(()=>[r(Ye,{modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=v=>a.value=v),theme:c(e),"onUpdate:theme":d[1]||(d[1]=v=>C(e)?e.value=v:null)},null,8,["modelValue","theme"]),r(dt),r(Ue,{color:"primary",density:"compact",class:"position-relative",flat:""},{prepend:u(()=>[r(Fe,{modelValue:y.value,"onUpdate:modelValue":d[2]||(d[2]=v=>y.value=v)},{default:u(()=>[(f(!0),T(D,null,te(c(k),v=>(f(),g(Ne,{key:v,value:v,to:"/"+v},{default:u(()=>[b(P(v),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])]),append:u(()=>[r(U,{icon:"mdi-cog",onClick:d[3]||(d[3]=I(v=>a.value=!0,["stop"]))})]),_:1}),r(Re,{class:"pa-0"},{default:u(()=>[r(V,null,{default:u(({Component:v})=>[r(Pe,null,{default:u(()=>[(f(),g(Be,{exclude:"ProjectView"},[(f(),g(Ee(v)))],1024))]),_:2},1024)]),_:1})]),_:1})]),_:1},8,["theme"])}}}),pt={class:"about"},mt=b(" This is an about page, return to "),ft=b("extract"),vt=b(". "),X=S({setup(l){return(t,o)=>(f(),T("div",pt,[M("h3",null,[mt,r(c(Oe),{to:"/extract"},{default:u(()=>[ft]),_:1}),vt])]))}});const _t=S({props:{options:null,src:null,fps:null},emits:["playerReady"],setup(l,{expose:t,emit:o}){const a=l;let e=w(null),s=w(null),n=w(0),i=w(B(0)),m=0;const y=(_,h="video/mp4")=>{!s.value||(s.value.paused()||s.value.pause(),s.value.src({src:_,type:h}),s.value.load(),s.value.currentTime(0))},k=()=>{a.src&&(typeof a.src=="string"?(console.log("setting string source"),y(a.src)):y(a.src.src,a.src.type))};R(()=>a.src,k),De(()=>{var _;s.value=ze(e.value,N({fluid:!0,muted:!0},a.options),()=>{k(),o("playerReady",s.value)}),(_=e.value)==null||_.requestVideoFrameCallback(p)});const p=(_,h)=>{var L;h.presentedFrames==1&&(console.debug("first frame",_,h),h.mediaTime>0?(console.log("accounting for video start drift of",h.mediaTime),m=h.mediaTime):m=0),n.value=Math.round((h.mediaTime-m)*a.fps),i.value=B(h.mediaTime-m),(L=e.value)==null||L.requestVideoFrameCallback(p)},d=_=>{s.value&&!s.value.paused()&&s.value.pause(),W(n.value+_)},V=(_=1)=>{d(_)},v=(_=1)=>{d(-_)},W=_=>{var L;const h=_/a.fps+m;console.log(`seeking to: ${_} (${B(h)})`,h),m&&console.log(`actual    : ${_} (${B(h-m)})`,h-m),(L=s.value)==null||L.currentTime(h+1e-5)};return t({frame:n,timecode:i,videojs:s,videoEl:e,setSource:y,seek:d,seekTo:W,seekForward:V,seekBackward:v}),(_,h)=>(f(),T("video",{ref_key:"videoEl",ref:e,class:"video-js vjs-big-play-centered",preload:"metadata",controls:""},[oe(_.$slots,"default")],512))}}),yt={class:"d-flex pa-2"},Vt=S({setup(l){let t=w(null);const o=j(),a=x(()=>"/videos/"+o.video),e=x(()=>{const p=new URL(a.value+"/stream",o.backend);return p.searchParams.append("project",o.project),p.toString()}),s=x(()=>{var p;return((p=t.value)==null?void 0:p.timecode)||0}),n=x({get:()=>{var p;return((p=t.value)==null?void 0:p.frame)||0},set:p=>{var d;(d=t.value)==null||d.seekTo(Number(p))}}),i=p=>{console.log("player-ready",p)},m=()=>{var p,d,V,v;(d=(p=t.value)==null?void 0:p.videojs)!=null&&d.paused()?t.value.videojs.play():(v=(V=t.value)==null?void 0:V.videojs)==null||v.pause()},{data:y}=q(a,{refetch:!0}).get().json(),k=x(()=>y.value?y.value.fps:-1);return(p,d)=>(f(),g(K,{fluid:"",class:"pa-0 fill-height"},{default:u(()=>[M("div",yt,[r(E,{label:"Frame",variant:"outlined",density:"compact",modelValue:c(n),"onUpdate:modelValue":d[0]||(d[0]=V=>C(n)?n.value=V:null),"hide-details":"","persistent-placeholder":""},null,8,["modelValue"]),r(E,{class:"pl-2",label:"Timecode",variant:"outlined",density:"compact",modelValue:c(s),"onUpdate:modelValue":d[1]||(d[1]=V=>C(s)?s.value=V:null),readonly:"","hide-details":"","persistent-placeholder":""},null,8,["modelValue"])]),r(_t,{ref_key:"player",ref:t,fps:c(k),src:c(e),onPlayerReady:i,onKeydown:[O(m,["space"]),d[2]||(d[2]=O(()=>{var V;return(V=t.value)==null?void 0:V.seekBackward()},["left"])),d[3]||(d[3]=O(()=>{var V;return(V=t.value)==null?void 0:V.seekForward()},["right"]))]},null,8,["fps","src","onKeydown"])]),_:1}))}}),ht={name:"ProjectView"},gt=S(J(N({},ht),{setup(l){const t=j(),o=w(!1),{isFetching:a,data:e}=q("/projects").get().json();return(s,n)=>(f(),g(K,{class:"d-flex flex-column",style:{"max-width":"640px"}},{default:u(()=>[r(Ke,{modelValue:c(t).project,"onUpdate:modelValue":n[0]||(n[0]=i=>c(t).project=i),items:c(e),loading:c(a),class:"pb-3",label:"Project",color:"primary","hide-details":"",clearable:""},null,8,["modelValue","items","loading"]),r(E,{class:"pb-3",label:"Video",color:"primary",disabled:!c(t).project,"model-value":c(t).video,onClick:n[1]||(n[1]=I(i=>o.value=!0,["stop"])),"hide-details":"",readonly:""},null,8,["disabled","model-value"]),r(ae,{modelValue:o.value,"onUpdate:modelValue":n[2]||(n[2]=i=>o.value=i)},null,8,["modelValue"])]),_:1}))}})),bt=Me({history:qe("/deeplabcut-webui/"),routes:[{path:"/",name:"home",redirect:()=>j().project?{name:"extract"}:{name:"project"}},{path:"/project",name:"project",component:gt},{path:"/extract",name:"extract",component:Vt},{path:"/label",name:"label",component:X},{path:"/analyse",name:"analyse",component:X}]});const kt="modulepreload",Y={},xt="/deeplabcut-webui/",wt=function(t,o){return!o||o.length===0?t():Promise.all(o.map(a=>{if(a=`${xt}${a}`,a in Y)return;Y[a]=!0;const e=a.endsWith(".css"),s=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${s}`))return;const n=document.createElement("link");if(n.rel=e?"stylesheet":kt,e||(n.as="script",n.crossOrigin=""),n.href=a,document.head.appendChild(n),e)return new Promise((i,m)=>{n.addEventListener("load",i),n.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>t())};async function St(){(await wt(()=>import("./webfontloader.ccf6ba4d.js").then(function(t){return t.w}),[])).load({google:{families:["Roboto:100,300,400,500,700,900&display=swap"]}})}St();var jt=We({theme:{variations:{colors:["primary","secondary"],lighten:1,darken:2},themes:{light:{colors:{primary:"#2196F3",secondary:"#E91E63"}},dark:{dark:!0,colors:{primary:"#212121",secondary:"#E91E63"}}}}});const A=He(ct);A.use(Ge());A.use(bt);A.use(jt);A.mount("#app");
